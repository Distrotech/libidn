Libidn libc/README -- Instructions for building as a GNU Libc add-on.
Copyright (C) 2003 Simon Josefsson
See the end for copying conditions.

GNU Libidn can be built into GNU Libc if you follow these
instructions.  Note that you should not run configure in Libidn.

1) Unpack Libc:

$ tar xfz glibc-2.3.2.tar.gz  # and glibc-linuxthreads if you need it

2) Unpack Libidn:

$ tar xfz ~/libidn-0.2.4.tar.gz

3) Set up the Libidn add-on inside the Libc directory:

$ cp -r libidn-0.2.4/libc glibc-2.3.2/libidn
$ cp libidn-0.2.4/libc/{Makefile,configure,Versions} glibc-2.3.2/libidn/
$ cp libidn-0.2.4/lib/*.{c,h} glibc-2.3.2/libidn/
$ cp libidn-0.2.4/libc/getaddrinfo.c glibc-2.3.2/sysdeps/posix/
$ ln -s ../libidn/idna.h glibc-2.3.2/include/
$ cp libidn-0.2.4/libc/netdb.h glibc-2.3.2/resolv/
$ touch glibc-2.3.2/libidn/libidn.texi

4) Configure and build Libc with the Libidn add-on:

$ mkdir glibc-2.3.2-obj
$ cd glibc-2.3.2-obj
$ ../glibc-2.3.2/configure --enable-add-ons=linuxthreads,libidn \
	--prefix=/usr/local/glibc
$ make install

5) Run the example:

$ cd ../glibc-2.3.2/libidn/libc
$ gcc -o example example.c -L/usr/local/glibc/lib -Wl,-rpath,/usr/local/glibc/lib -nostdinc -I/usr/local/glibc/include -I/usr/include -I/usr/lib/gcc-lib/i386-linux/2.95.4/include
$ CHARSET=iso-8859-1 ./example
locale charset `iso-8859-1'
gettaddrinfo(räksmörgås.josefsson.org):
address `217.13.230.178'
canonical name `178.230.13.217.in-addr.dgcsystems.net'
$

Internally the domain name xn--rksmrgs-5wao1o.josefsson.org is looked
up in DNS.

The file libc.patch in this directory contains the modifications made
to getaddrinfo.c and netdb.h, should you wish to try this with another
GNU Libc version.  With minor modifications, it has been verified to
work with 2.3.1.

----------------------------------------------------------------------
Copying and distribution of this file, with or without modification,
are permitted in any medium without royalty provided the copyright
notice and this notice are preserved.
